{"version":3,"sources":["../src/public/query_ctrl.js"],"names":[],"mappings":"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","file":"query_ctrl.js","sourcesContent":["///<reference path=\"app/headers/common.d.ts\" />\nSystem.register(['./query_part_editor', 'angular', 'lodash', './query_builder', './sql_query', './query_part', 'app/plugins/sdk'], function(exports_1) {\n    var __extends = (this && this.__extends) || function (d, b) {\n        for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n    var angular_1, lodash_1, query_builder_1, sql_query_1, query_part_1, sdk_1;\n    var SqlQueryCtrl;\n    return {\n        setters:[\n            function (_1) {},\n            function (angular_1_1) {\n                angular_1 = angular_1_1;\n            },\n            function (lodash_1_1) {\n                lodash_1 = lodash_1_1;\n            },\n            function (query_builder_1_1) {\n                query_builder_1 = query_builder_1_1;\n            },\n            function (sql_query_1_1) {\n                sql_query_1 = sql_query_1_1;\n            },\n            function (query_part_1_1) {\n                query_part_1 = query_part_1_1;\n            },\n            function (sdk_1_1) {\n                sdk_1 = sdk_1_1;\n            }],\n        execute: function() {\n            SqlQueryCtrl = (function (_super) {\n                __extends(SqlQueryCtrl, _super);\n                /** @ngInject **/\n                function SqlQueryCtrl($scope, $injector, templateSrv, $q, uiSegmentSrv) {\n                    _super.call(this, $scope, $injector);\n                    this.templateSrv = templateSrv;\n                    this.$q = $q;\n                    this.uiSegmentSrv = uiSegmentSrv;\n                    this.target = this.target;\n                    this.matchOperators = query_part_1.default.getMatchOperators(this.datasource.dbms);\n                    this.queryModel = new sql_query_1.default(this.target, templateSrv, this.panel.scopedVars);\n                    this.queryBuilder = new query_builder_1.default(this.target, { matchOperators: this.matchOperators });\n                    this.resultFormats = [\n                        { text: 'Time series', value: 'time_series' },\n                        { text: 'Table', value: 'table' },\n                    ];\n                    this.schemaSegment = uiSegmentSrv.newSegment(this.target.schema);\n                    if (!this.target.table) {\n                        this.tableSegment = uiSegmentSrv.newSelectMeasurement();\n                    }\n                    else {\n                        this.tableSegment = uiSegmentSrv.newSegment(this.target.table);\n                    }\n                    this.timeColDataTypeSegment = uiSegmentSrv.newSegment(this.target.timeColDataType);\n                    this.tagSegments = [];\n                    for (var _i = 0, _a = this.target.tags; _i < _a.length; _i++) {\n                        var tag = _a[_i];\n                        if (!tag.operator) {\n                            if (/^\\/.*\\/$/.test(tag.value)) {\n                                tag.operator = this.matchOperators.match;\n                            }\n                            else {\n                                tag.operator = '=';\n                            }\n                        }\n                        if (tag.condition) {\n                            this.tagSegments.push(uiSegmentSrv.newCondition(tag.condition));\n                        }\n                        this.tagSegments.push(uiSegmentSrv.newKey(tag.key));\n                        this.tagSegments.push(uiSegmentSrv.newOperator(tag.operator));\n                        this.tagSegments.push(uiSegmentSrv.newKeyValue(tag.value));\n                    }\n                    this.fixTagSegments();\n                    this.buildSelectMenu();\n                    this.removeTagFilterSegment = uiSegmentSrv.newSegment({ fake: true, value: '-- remove tag filter --' });\n                    /*\n                     TODO:\n                     This doen't work well when trying to change a parameter from the default value put by setDefault().\n                    if (this.target.isNew) {\n                      this.setDefault();\n                    }\n                    */\n                }\n                SqlQueryCtrl.prototype.setDefault = function () {\n                    var _this = this;\n                    var query = this.queryBuilder.buildExploreQuery('SET_DEFAULT');\n                    this.datasource._seriesQuery(query).then(function (data) {\n                        if (!data.results[0].series[0].values) {\n                            return;\n                        }\n                        var result = data.results[0].series[0].values[0];\n                        _this.target.schema = result[0];\n                        _this.target.table = result[1];\n                        _this.target.timeColDataType = result[2];\n                        _this.schemaSegment = _this.uiSegmentSrv.newSegment(_this.target.schema);\n                        _this.tableSegment = _this.uiSegmentSrv.newSegment(_this.target.table);\n                        _this.timeColDataTypeSegment = _this.uiSegmentSrv.newSegment(_this.target.timeColDataType);\n                    });\n                };\n                SqlQueryCtrl.prototype.buildSelectMenu = function () {\n                    var categories = query_part_1.default.getCategories();\n                    this.selectMenu = lodash_1.default.reduce(categories, function (memo, cat, key) {\n                        var menu = {\n                            text: key,\n                            submenu: cat.map(function (item) {\n                                return { text: item.type, value: item.type };\n                            }),\n                        };\n                        memo.push(menu);\n                        return memo;\n                    }, []);\n                };\n                SqlQueryCtrl.prototype.groupByAction = function () {\n                    this.panelCtrl.refresh();\n                };\n                SqlQueryCtrl.prototype.removeGroupByPart = function (part, index) {\n                    this.queryModel.removeGroupByPart(part, index);\n                    this.panelCtrl.refresh();\n                };\n                SqlQueryCtrl.prototype.addSelectPart = function (selectParts, cat, subitem) {\n                    this.queryModel.addSelectPart(selectParts, subitem.value);\n                    this.panelCtrl.refresh();\n                };\n                SqlQueryCtrl.prototype.removeSelectPart = function (selectParts, part) {\n                    this.queryModel.removeSelectPart(selectParts, part);\n                    this.panelCtrl.refresh();\n                };\n                SqlQueryCtrl.prototype.selectPartUpdated = function () {\n                    this.panelCtrl.refresh();\n                };\n                SqlQueryCtrl.prototype.fixTagSegments = function () {\n                    var count = this.tagSegments.length;\n                    var lastSegment = this.tagSegments[Math.max(count - 1, 0)];\n                    if (!lastSegment || lastSegment.type !== 'plus-button') {\n                        this.tagSegments.push(this.uiSegmentSrv.newPlusButton());\n                    }\n                };\n                SqlQueryCtrl.prototype.tableChanged = function () {\n                    this.target.table = this.tableSegment.value;\n                    this.panelCtrl.refresh();\n                };\n                SqlQueryCtrl.prototype.getSchemaSegments = function () {\n                    var schemasQuery = this.queryBuilder.buildExploreQuery('SCHEMA');\n                    return this.datasource.metricFindQuery(schemasQuery)\n                        .then(this.transformToSegments(false))\n                        .catch(this.handleQueryError.bind(this));\n                };\n                SqlQueryCtrl.prototype.schemaChanged = function () {\n                    this.target.schema = this.schemaSegment.value;\n                    this.panelCtrl.refresh();\n                };\n                SqlQueryCtrl.prototype.getTimeColDataTypeSegments = function () {\n                    var timeColQuery = this.queryBuilder.buildExploreQuery('FIELDS');\n                    return this.datasource.metricFindQuery(timeColQuery)\n                        .then(this.transformToSegments(false))\n                        .catch(this.handleQueryError.bind(this));\n                };\n                SqlQueryCtrl.prototype.timeColDataTypeChanged = function () {\n                    this.target.timeColDataType = this.timeColDataTypeSegment.value;\n                    this.panelCtrl.refresh();\n                };\n                SqlQueryCtrl.prototype.toggleEditorMode = function () {\n                    try {\n                        this.target.query = this.queryModel.render(false);\n                    }\n                    catch (err) {\n                        console.log('query render error');\n                    }\n                    this.target.rawQuery = !this.target.rawQuery;\n                };\n                SqlQueryCtrl.prototype.getTableSegments = function () {\n                    var query = this.queryBuilder.buildExploreQuery('TABLES');\n                    return this.datasource.metricFindQuery(query)\n                        .then(this.transformToSegments(true))\n                        .catch(this.handleQueryError.bind(this));\n                };\n                SqlQueryCtrl.prototype.getPartOptions = function (part) {\n                    if (part.def.type === 'field') {\n                        var fieldsQuery = this.queryBuilder.buildExploreQuery('TAG_KEYS');\n                        return this.datasource.metricFindQuery(fieldsQuery)\n                            .then(this.transformToSegments(true))\n                            .catch(this.handleQueryError.bind(this));\n                    }\n                };\n                SqlQueryCtrl.prototype.handleQueryError = function (err) {\n                    this.error = err.message || 'Failed to issue metric query';\n                    return [];\n                };\n                SqlQueryCtrl.prototype.transformToSegments = function (addTemplateVars) {\n                    var _this = this;\n                    return function (results) {\n                        var segments = lodash_1.default.map(results, function (segment) {\n                            return _this.uiSegmentSrv.newSegment({ value: segment.text, expandable: segment.expandable });\n                        });\n                        if (addTemplateVars) {\n                            for (var _i = 0, _a = _this.templateSrv.variables; _i < _a.length; _i++) {\n                                var variable = _a[_i];\n                                segments.unshift(_this.uiSegmentSrv.newSegment({\n                                    type: 'template', value: '/^$' + variable.name + '$/', expandable: true\n                                }));\n                                segments.unshift(_this.uiSegmentSrv.newSegment({\n                                    type: 'template', value: '$' + variable.name, expandable: true\n                                }));\n                            }\n                        }\n                        return segments;\n                    };\n                };\n                SqlQueryCtrl.prototype.getTagsOrValues = function (segment, index) {\n                    var _this = this;\n                    if (segment.type === 'condition') {\n                        return this.$q.when([\n                            this.uiSegmentSrv.newSegment('AND'), this.uiSegmentSrv.newSegment('OR')\n                        ]);\n                    }\n                    if (segment.type === 'operator') {\n                        var nextValue = this.tagSegments[index + 1].value;\n                        if (/^\\/.*\\/$/.test(nextValue)) {\n                            return this.$q.when(this.uiSegmentSrv.newOperators([\n                                this.matchOperators.match, this.matchOperators.not\n                            ]));\n                        }\n                        else {\n                            return this.$q.when(this.uiSegmentSrv.newOperators([\n                                '=', '<>', '<', '>'\n                            ]));\n                        }\n                    }\n                    var query, addTemplateVars;\n                    if (segment.type === 'key' || segment.type === 'plus-button') {\n                        query = this.queryBuilder.buildExploreQuery('TAG_KEYS');\n                        addTemplateVars = false;\n                    }\n                    else if (segment.type === 'value') {\n                        query = this.queryBuilder.buildExploreQuery('TAG_VALUES', this.tagSegments[index - 2].value);\n                        addTemplateVars = true;\n                    }\n                    return this.datasource.metricFindQuery(query)\n                        .then(this.transformToSegments(addTemplateVars))\n                        .then(function (results) {\n                        if (segment.type === 'key') {\n                            results.splice(0, 0, angular_1.default.copy(_this.removeTagFilterSegment));\n                        }\n                        return results;\n                    })\n                        .catch(this.handleQueryError.bind(this));\n                };\n                SqlQueryCtrl.prototype.getFieldSegments = function () {\n                    var fieldsQuery = this.queryBuilder.buildExploreQuery('TAG_KEYS');\n                    return this.datasource.metricFindQuery(fieldsQuery)\n                        .then(this.transformToSegments(false))\n                        .catch(this.handleQueryError);\n                };\n                SqlQueryCtrl.prototype.tagSegmentUpdated = function (segment, index) {\n                    this.tagSegments[index] = segment;\n                    // handle remove tag condition\n                    if (segment.value === this.removeTagFilterSegment.value) {\n                        this.tagSegments.splice(index, 3);\n                        if (this.tagSegments.length === 0) {\n                            this.tagSegments.push(this.uiSegmentSrv.newPlusButton());\n                        }\n                        else if (this.tagSegments.length > 2) {\n                            this.tagSegments.splice(Math.max(index - 1, 0), 1);\n                            if (this.tagSegments[this.tagSegments.length - 1].type !== 'plus-button') {\n                                this.tagSegments.push(this.uiSegmentSrv.newPlusButton());\n                            }\n                        }\n                    }\n                    else {\n                        if (segment.type === 'plus-button') {\n                            if (index > 2) {\n                                this.tagSegments.splice(index, 0, this.uiSegmentSrv.newCondition('AND'));\n                            }\n                            this.tagSegments.push(this.uiSegmentSrv.newOperator('='));\n                            this.tagSegments.push(this.uiSegmentSrv.newFake('select tag value', 'value', 'query-segment-value'));\n                            segment.type = 'key';\n                            segment.cssClass = 'query-segment-key';\n                        }\n                        if ((index + 1) === this.tagSegments.length) {\n                            this.tagSegments.push(this.uiSegmentSrv.newPlusButton());\n                        }\n                    }\n                    this.rebuildTargetTagConditions();\n                };\n                SqlQueryCtrl.prototype.rebuildTargetTagConditions = function () {\n                    var _this = this;\n                    var tags = [];\n                    var tagIndex = 0;\n                    var tagOperator = \"\";\n                    lodash_1.default.each(this.tagSegments, function (segment2, index) {\n                        if (segment2.type === 'key') {\n                            if (tags.length === 0) {\n                                tags.push({});\n                            }\n                            tags[tagIndex].key = segment2.value;\n                        }\n                        else if (segment2.type === 'value') {\n                            tagOperator = _this.getTagValueOperator(segment2.value, tags[tagIndex].operator);\n                            if (tagOperator) {\n                                _this.tagSegments[index - 1] = _this.uiSegmentSrv.newOperator(tagOperator);\n                                tags[tagIndex].operator = tagOperator;\n                            }\n                            tags[tagIndex].value = segment2.value;\n                        }\n                        else if (segment2.type === 'condition') {\n                            tags.push({ condition: segment2.value });\n                            tagIndex += 1;\n                        }\n                        else if (segment2.type === 'operator') {\n                            tags[tagIndex].operator = segment2.value;\n                        }\n                    });\n                    this.target.tags = tags;\n                    this.panelCtrl.refresh();\n                };\n                SqlQueryCtrl.prototype.getTagValueOperator = function (tagValue, tagOperator) {\n                    if (tagOperator !== this.matchOperators.match &&\n                        tagOperator !== this.matchOperators.not &&\n                        /^\\/.*\\/$/.test(tagValue)) {\n                        return this.matchOperators.match;\n                    }\n                    else if ((tagOperator === this.matchOperators.match ||\n                        tagOperator === this.matchOperators.not) &&\n                        /^(?!\\/.*\\/$)/.test(tagValue)) {\n                        return '=';\n                    }\n                };\n                SqlQueryCtrl.prototype.getCollapsedText = function () {\n                    return this.queryModel.render(false);\n                };\n                SqlQueryCtrl.templateUrl = 'partials/query.editor.html';\n                return SqlQueryCtrl;\n            })(sdk_1.QueryCtrl);\n            exports_1(\"SqlQueryCtrl\", SqlQueryCtrl);\n        }\n    }\n});\n//# sourceMappingURL=query_ctrl.js.map"]}